[Thu Feb 15 05:00:54 PM PST 2024] The retrieved sample id is HG002_bam
[Thu Feb 15 05:00:54 PM PST 2024] Start downloading external data ...
[Thu Feb 15 05:00:54 PM PST 2024] Start downloading https://s3-us-west-2.amazonaws.com/human-pangenomics/submissions/48f9717b-23c6-4045-a33f-10a3df8fc924--UW_HPRC_HiFi/HG002/PacBio_HiFi/m64076_201013_225902.ccs.bam ...
[Thu Feb 15 05:09:38 PM PST 2024] Downloaded https://s3-us-west-2.amazonaws.com/human-pangenomics/submissions/48f9717b-23c6-4045-a33f-10a3df8fc924--UW_HPRC_HiFi/HG002/PacBio_HiFi/m64076_201013_225902.ccs.bam
[Thu Feb 15 05:09:38 PM PST 2024] Start running Toil job ...
You are using cwltool version 3.1.20220224085855, which might not be compatible with version 3.1.20230601100705 used by Toil. You should consider running 'pip install cwltool==3.1.20230601100705' to match Toil's cwltool version.
[2024-02-15T17:09:39-0800] [MainThread] [W] [toil.utils.toilClean] Job store does not appear to exist. Deleting anyway.
[2024-02-15T17:09:39-0800] [MainThread] [I] [toil.utils.toilClean] Successfully deleted the job store: /data/tmp/masri/HG002_bam_extract_reads/jobstore
You are using cwltool version 3.1.20220224085855, which might not be compatible with version 3.1.20230601100705 used by Toil. You should consider running 'pip install cwltool==3.1.20230601100705' to match Toil's cwltool version.
[2024-02-15T17:09:42-0800] [MainThread] [I] [toil.wdl.wdltoil] Imported file:///data/tmp/masri/HG002_bam_extract_reads/m64076_201013_225902.ccs.bam
[2024-02-15T17:09:42-0800] [MainThread] [I] [toil.wdl.wdltoil] Imported file:///private/groups/patenlab/masri/hprc/polishing/HG002/assemblies/GCA_000001405.15_GRCh38_no_alt_analysis_set.fna
[2024-02-15T17:09:42-0800] [MainThread] [I] [toil.job] Saving graph of 1 jobs, 1 non-service, 1 new
[2024-02-15T17:09:42-0800] [MainThread] [I] [toil.job] Processing job 'WDLRootJob' kind-WDLRootJob/instance-6b6hijzn v0
[2024-02-15T17:09:42-0800] [MainThread] [I] [toil] Running Toil version 5.12.0a1-f0f3133896b1004769e52ca8141dd8177ed62fc9 on host phoenix-14.prism.
You are using cwltool version 3.1.20220224085855, which might not be compatible with version 3.1.20230601100705 used by Toil. You should consider running 'pip install cwltool==3.1.20230601100705' to match Toil's cwltool version.
[2024-02-15T17:09:43-0800] [MainThread] [I] [toil.worker] Redirecting logging to /data/tmp/bc6de80c74205c86b17598b671c3ea3a/e983/worker_log.txt
[2024-02-15T17:09:43-0800] [MainThread] [I] [toil.leader] 0 jobs are running, 0 jobs are issued and waiting to run
You are using cwltool version 3.1.20220224085855, which might not be compatible with version 3.1.20230601100705 used by Toil. You should consider running 'pip install cwltool==3.1.20230601100705' to match Toil's cwltool version.
[2024-02-15T17:09:45-0800] [MainThread] [I] [toil.worker] Redirecting logging to /data/tmp/bc6de80c74205c86b17598b671c3ea3a/d91e/worker_log.txt
You are using cwltool version 3.1.20220224085855, which might not be compatible with version 3.1.20230601100705 used by Toil. You should consider running 'pip install cwltool==3.1.20230601100705' to match Toil's cwltool version.
[2024-02-15T17:09:46-0800] [MainThread] [I] [toil.worker] Redirecting logging to /data/tmp/bc6de80c74205c86b17598b671c3ea3a/86ce/worker_log.txt
[2024-02-15T17:09:47-0800] [MainThread] [I] [toil.leader] Issued job 'WDLTaskJob' runExtractReads.extractReads kind-WDLTaskJob/instance-bf9ridrc v1 with job batch system ID: 4 and disk: 2.0 Gi, memory: 2.0 Gi, cores: 1, accelerators: [], preemptible: False
You are using cwltool version 3.1.20220224085855, which might not be compatible with version 3.1.20230601100705 used by Toil. You should consider running 'pip install cwltool==3.1.20230601100705' to match Toil's cwltool version.
[2024-02-15T17:09:48-0800] [MainThread] [I] [toil.worker] Redirecting logging to /data/tmp/bc6de80c74205c86b17598b671c3ea3a/17fd/worker_log.txt
[2024-02-15T17:09:48-0800] [MainThread] [I] [toil.leader] Issued job 'WDLTaskJob' runExtractReads.extractReads kind-WDLTaskJob/instance-95_43wmw v1 with job batch system ID: 5 and disk: 119.2 Gi, memory: 14.9 Gi, cores: 8.0, accelerators: [], preemptible: False
You are using cwltool version 3.1.20220224085855, which might not be compatible with version 3.1.20230601100705 used by Toil. You should consider running 'pip install cwltool==3.1.20230601100705' to match Toil's cwltool version.
[2024-02-15T17:09:49-0800] [MainThread] [I] [toil.worker] Redirecting logging to /data/tmp/bc6de80c74205c86b17598b671c3ea3a/68ce/worker_log.txt
[2024-02-15T17:09:57-0800] [Thread-1 (daddy)] [E] [toil.batchSystems.singleMachine] Got exit code 1 (indicating failure) from job _toil_worker WDLTaskJob file:/data/tmp/masri/HG002_bam_extract_reads/jobstore kind-WDLTaskJob/instance-95_43wmw.
[2024-02-15T17:09:57-0800] [MainThread] [W] [toil.leader] Job failed with exit value 1: 'WDLTaskJob' runExtractReads.extractReads kind-WDLTaskJob/instance-95_43wmw v1
Exit reason: None
[2024-02-15T17:09:57-0800] [MainThread] [W] [toil.leader] The job seems to have left a log file, indicating failure: 'WDLTaskJob' runExtractReads.extractReads kind-WDLTaskJob/instance-95_43wmw v2
[2024-02-15T17:09:57-0800] [MainThread] [W] [toil.leader] Log from job "kind-WDLTaskJob/instance-95_43wmw" follows:
=========>
	[2024-02-15T17:09:49-0800] [MainThread] [I] [toil.worker] ---TOIL WORKER OUTPUT LOG---
	[2024-02-15T17:09:49-0800] [MainThread] [I] [toil] Running Toil version 5.12.0a1-f0f3133896b1004769e52ca8141dd8177ed62fc9 on host phoenix-14.prism.
	[2024-02-15T17:09:49-0800] [MainThread] [I] [toil.worker] Working on job 'WDLTaskJob' runExtractReads.extractReads kind-WDLTaskJob/instance-95_43wmw v1
	[2024-02-15T17:09:49-0800] [MainThread] [I] [toil.worker] Loaded body Job('WDLTaskJob' runExtractReads.extractReads kind-WDLTaskJob/instance-95_43wmw v1) from description 'WDLTaskJob' runExtractReads.extractReads kind-WDLTaskJob/instance-95_43wmw v1
	[2024-02-15T17:09:49-0800] [MainThread] [I] [toil.wdl.wdltoil] Running task extractReads (['extractReads']) called as runExtractReads.extractReads
	[2024-02-15T17:09:49-0800] [MainThread] [I] [toil.wdl.wdltoil] Defaulting excludeString to ""
	[2024-02-15T17:09:49-0800] [MainThread] [I] [toil.wdl.wdltoil] Defaulting fastqOptions to ""
	[2024-02-15T17:09:49-0800] [MainThread] [I] [toil.wdl.wdltoil] Defaulting memSizeGB to 16
	[2024-02-15T17:09:49-0800] [MainThread] [I] [toil.wdl.wdltoil] Defaulting diskSizeGB to 128
	[2024-02-15T17:09:49-0800] [MainThread] [I] [MiniWDLContainers] no configuration file found
	[2024-02-15T17:09:49-0800] [MainThread] [N] [MiniWDLContainers] Singularity runtime initialized (BETA) :: singularity_version: "singularity-ce version 3.10.3"
	[2024-02-15T17:09:49-0800] [MainThread] [I] [MiniWDLContainers] detected host resources :: cpu: 256, mem_bytes: 2151640911872
	[2024-02-15T17:09:56-0800] [MainThread] [I] [MiniWDLContainers] Singularity SIF found in image cache directory :: sif: "/private/groups/patenlab/masri/apps/forked/hpp_production_workflows/QC/wdl/tasks/extract_reads_test/extract_reads_output_jsons/outputs/cache/.cache/miniwdl/docker___mobinasri_bio_base_dev-v0.1.sif"
	[2024-02-15T17:09:56-0800] [MainThread] [I] [toil.wdl.wdltoil] Executing command in <WDL.runtime.backend.singularity.SingularityContainer object at 0x7f8af40aafe0>: 
	        # Set the exit code of a pipeline to that of the rightmost command
	        # to exit with a non-zero status, or zero if all commands of the pipeline exit
	        set -o pipefail
	        # cause a bash script to exit immediately when a command fails
	        set -e
	        # cause the bash shell to treat unset variables as an error and exit immediately
	        set -u
	        # echo each line of the script to stdout so we can see what is happening
	        # to turn off echo do 'set +o xtrace'
	        set -o xtrace
	
	        FILENAME=$(basename -- "/mnt/miniwdl_task_container/work/_miniwdl_inputs/0/m64076_201013_225902.ccs.bam")
	        PREFIX="${FILENAME%.*}"
	        SUFFIX="${FILENAME##*.}"
	
	        mkdir output
	        SORT_BY_NAME=no
	
	        if [[ "$SUFFIX" == "bam" ]] ; then
	            if [[ ${SORT_BY_NAME} == "yes" ]]; then
	                samtools sort -@8 -n /mnt/miniwdl_task_container/work/_miniwdl_inputs/0/m64076_201013_225902.ccs.bam | samtools fastq  -@8 - > output/${PREFIX}.fq
	            else
	                samtools fastq  -@8 /mnt/miniwdl_task_container/work/_miniwdl_inputs/0/m64076_201013_225902.ccs.bam > output/${PREFIX}.fq      
	            fi
	        elif [[ "$SUFFIX" == "cram" ]] ; then
	            if [[ ! -f "/mnt/miniwdl_task_container/work/_miniwdl_inputs/0/GCA_000001405.15_GRCh38_no_alt_analysis_set.fna" ]] ; then
	                echo "Could not extract $FILENAME, reference file not supplied"
	                exit 1
	            fi
	            ln -s /mnt/miniwdl_task_container/work/_miniwdl_inputs/0/GCA_000001405.15_GRCh38_no_alt_analysis_set.fna
	            if [[ ${SORT_BY_NAME} == "yes" ]]; then
	                samtools sort -@8 -n --reference `basename /mnt/miniwdl_task_container/work/_miniwdl_inputs/0/GCA_000001405.15_GRCh38_no_alt_analysis_set.fna` -O bam /mnt/miniwdl_task_container/work/_miniwdl_inputs/0/m64076_201013_225902.ccs.bam | samtools fastq  -@8 - > output/${PREFIX}.fq
	            elif
	                samtools fastq  -@8 --reference `basename /mnt/miniwdl_task_container/work/_miniwdl_inputs/0/GCA_000001405.15_GRCh38_no_alt_analysis_set.fna` /mnt/miniwdl_task_container/work/_miniwdl_inputs/0/m64076_201013_225902.ccs.bam > output/${PREFIX}.fq
	            fi
	        elif [[ "$SUFFIX" == "gz" ]] ; then
	            gunzip -k -c /mnt/miniwdl_task_container/work/_miniwdl_inputs/0/m64076_201013_225902.ccs.bam > output/${PREFIX}
	        elif [[ "$SUFFIX" == "fastq" ]] || [[ "$SUFFIX" == "fq" ]] ; then
	            cp /mnt/miniwdl_task_container/work/_miniwdl_inputs/0/m64076_201013_225902.ccs.bam output/${PREFIX}.fq
	        elif [[ "$SUFFIX" != "fastq" ]] && [[ "$SUFFIX" != "fq" ]] && [[ "$SUFFIX" != "fasta" ]] && [[ "$SUFFIX" != "fa" ]] ; then
	            echo "Unsupported file type: ${SUFFIX}"
	            exit 1
	        fi
	
	
	        mkdir output_final
	        OUTPUT_NAME=$(ls output)
	
	        if [ "" != "" ]; then
	            cat output/${OUTPUT_NAME} | grep -v "" > output_final/${OUTPUT_NAME}
	        else
	            ln output/${OUTPUT_NAME} output_final/${OUTPUT_NAME}
	        fi
	        
	
	        OUTPUTSIZE=`du -s -BG output_final/ | sed 's/G.*//'`
	        if [[ "0" == $OUTPUTSIZE ]] ; then
	            OUTPUTSIZE=`du -s -BG /mnt/miniwdl_task_container/work/_miniwdl_inputs/0/m64076_201013_225902.ccs.bam | sed 's/G.*//'`
	        fi
	        echo $OUTPUTSIZE >outputsize
	    
	[2024-02-15T17:09:56-0800] [MainThread] [I] [MiniWDLContainers] provisioned :: seconds_waited: 0, cpu: 8, mem_bytes: 16000000000
	[2024-02-15T17:09:56-0800] [MainThread] [I] [MiniWDLContainers] Singularity SIF found in image cache directory :: sif: "/private/groups/patenlab/masri/apps/forked/hpp_production_workflows/QC/wdl/tasks/extract_reads_test/extract_reads_output_jsons/outputs/cache/.cache/miniwdl/docker___mobinasri_bio_base_dev-v0.1.sif"
	[2024-02-15T17:09:56-0800] [MainThread] [I] [MiniWDLContainers] singularity invocation :: args: "singularity exec --pwd /mnt/miniwdl_task_container/work --containall --no-mount hostfs --fakeroot /private/groups/patenlab/masri/apps/forked/hpp_production_workflows/QC/wdl/tasks/extract_reads_test/extract_reads_output_jsons/outputs/cache/.cache/miniwdl/docker___mobinasri_bio_base_dev-v0.1.sif", binds: 8, tmpdir: "/data/tmp/bc6de80c74205c86b17598b671c3ea3a/68ce/e872/_singularity_tmpdir_d34ik7ij"
	[2024-02-15T17:09:56-0800] [MainThread] [W] [toil.wdl.wdltoil] No subuids are assigned to masri; cannot fake root.
	[2024-02-15T17:09:56-0800] [MainThread] [N] [MiniWDLContainers] singularity run :: pid: 3186580, log: "/data/tmp/bc6de80c74205c86b17598b671c3ea3a/68ce/e872/singularity.log.txt"
	[2024-02-15T17:09:56-0800] [MainThread] [I] [toil.wdl.wdltoil] Standard error at /data/tmp/bc6de80c74205c86b17598b671c3ea3a/68ce/e872/stderr.txt: ++ basename -- /mnt/miniwdl_task_container/work/_miniwdl_inputs/0/m64076_201013_225902.ccs.bam
	+ FILENAME=m64076_201013_225902.ccs.bam
	+ PREFIX=m64076_201013_225902.ccs
	+ SUFFIX=bam
	+ mkdir output
	+ SORT_BY_NAME=no
	../command: line 36: syntax error near unexpected token `fi'
	
	[2024-02-15T17:09:56-0800] [MainThread] [I] [toil.wdl.wdltoil] Standard output at /data/tmp/bc6de80c74205c86b17598b671c3ea3a/68ce/e872/stdout.txt: 
	[2024-02-15T17:09:56-0800] [MainThread] [W] [toil.fileStores.abstractFileStore] Failed job accessed files:
	[2024-02-15T17:09:56-0800] [MainThread] [W] [toil.fileStores.abstractFileStore] Downloaded file 'files/no-job/file-a382b4b6727449b7b872beaf4d6d8bf7/GCA_000001405.15_GRCh38_no_alt_analysis_set.fna' to path '/data/tmp/bc6de80c74205c86b17598b671c3ea3a/68ce/e872/tmpvmo3wdkb/GCA_000001405.15_GRCh38_no_alt_analysis_set.fna'
	[2024-02-15T17:09:56-0800] [MainThread] [W] [toil.fileStores.abstractFileStore] Downloaded file 'files/no-job/file-f51b53882cc747e699e0f3c310a9731e/m64076_201013_225902.ccs.bam' to path '/data/tmp/bc6de80c74205c86b17598b671c3ea3a/68ce/e872/tmp_aeotbf6/m64076_201013_225902.ccs.bam'
	Traceback (most recent call last):
	  File "/private/home/masri/.local/lib/python3.10/site-packages/toil/worker.py", line 403, in workerScript
	    job._runner(jobGraph=None, jobStore=jobStore, fileStore=fileStore, defer=defer)
	  File "/private/home/masri/.local/lib/python3.10/site-packages/toil/job.py", line 2774, in _runner
	    returnValues = self._run(jobGraph=None, fileStore=fileStore)
	  File "/private/home/masri/.local/lib/python3.10/site-packages/toil/job.py", line 2691, in _run
	    return self.run(fileStore)
	  File "/private/home/masri/.local/lib/python3.10/site-packages/toil/wdl/wdltoil.py", line 1246, in run
	    task_container.run(miniwdl_logger, command_string)
	  File "/private/home/masri/.local/lib/python3.10/site-packages/WDL/runtime/task_container.py", line 326, in run
	    raise CommandFailed(
	WDL.runtime.error.CommandFailed: task command failed with exit status 2
	[2024-02-15T17:09:56-0800] [MainThread] [E] [toil.worker] Exiting the worker because of a failed job on host phoenix-14.prism
<=========
[2024-02-15T17:09:57-0800] [MainThread] [W] [toil.job] Due to failure we are reducing the remaining try count of job 'WDLTaskJob' runExtractReads.extractReads kind-WDLTaskJob/instance-95_43wmw v2 with ID kind-WDLTaskJob/instance-95_43wmw to 0
[2024-02-15T17:09:57-0800] [MainThread] [W] [toil.leader] Job 'WDLTaskJob' runExtractReads.extractReads kind-WDLTaskJob/instance-95_43wmw v3 is completely failed
[2024-02-15T17:10:09-0800] [MainThread] [I] [toil.leader] Finished toil run with 5 failed jobs.
[2024-02-15T17:10:09-0800] [MainThread] [I] [toil.leader] Failed jobs at end of the run: 'WDLTaskJob' runExtractReads.extractReads kind-WDLTaskJob/instance-bf9ridrc v2 'WDLScatterJob' scatter-L11C5-file kind-WDLWorkflowNodeJob/instance-y8ral952 v4 'WDLWorkflowJob' kind-WDLRootJob/instance-6b6hijzn v4 'WDLWorkflowNodeJob' call-extractReads kind-WDLWorkflowNodeJob/instance-93r1yrwr v2 'WDLTaskJob' runExtractReads.extractReads kind-WDLTaskJob/instance-95_43wmw v3
Traceback (most recent call last):
  File "/private/home/masri/.local/bin/toil-wdl-runner", line 8, in <module>
    sys.exit(main())
  File "/private/home/masri/.local/lib/python3.10/site-packages/toil/wdl/wdltoil.py", line 2039, in main
    output_bindings = toil.start(root_job)
  File "/private/home/masri/.local/lib/python3.10/site-packages/toil/common.py", line 1064, in start
    return self._runMainLoop(rootJobDescription)
  File "/private/home/masri/.local/lib/python3.10/site-packages/toil/common.py", line 1544, in _runMainLoop
    jobCache=self._jobCache).run()
  File "/private/home/masri/.local/lib/python3.10/site-packages/toil/leader.py", line 289, in run
    raise FailedJobsException(self.jobStore, failed_jobs, exit_code=self.recommended_fail_exit_code)
toil.exceptions.FailedJobsException: The job store '/data/tmp/masri/HG002_bam_extract_reads/jobstore' contains 5 failed jobs: 'WDLTaskJob' runExtractReads.extractReads kind-WDLTaskJob/instance-bf9ridrc v2, 'WDLScatterJob' scatter-L11C5-file kind-WDLWorkflowNodeJob/instance-y8ral952 v4, 'WDLWorkflowJob' kind-WDLRootJob/instance-6b6hijzn v4, 'WDLWorkflowNodeJob' call-extractReads kind-WDLWorkflowNodeJob/instance-93r1yrwr v2, 'WDLTaskJob' runExtractReads.extractReads kind-WDLTaskJob/instance-95_43wmw v3
Log from job "'WDLTaskJob' runExtractReads.extractReads kind-WDLTaskJob/instance-95_43wmw v3" follows:
=========>
	[2024-02-15T17:09:49-0800] [MainThread] [I] [toil.worker] ---TOIL WORKER OUTPUT LOG---
	[2024-02-15T17:09:49-0800] [MainThread] [I] [toil] Running Toil version 5.12.0a1-f0f3133896b1004769e52ca8141dd8177ed62fc9 on host phoenix-14.prism.
	[2024-02-15T17:09:49-0800] [MainThread] [I] [toil.worker] Working on job 'WDLTaskJob' runExtractReads.extractReads kind-WDLTaskJob/instance-95_43wmw v1
	[2024-02-15T17:09:49-0800] [MainThread] [I] [toil.worker] Loaded body Job('WDLTaskJob' runExtractReads.extractReads kind-WDLTaskJob/instance-95_43wmw v1) from description 'WDLTaskJob' runExtractReads.extractReads kind-WDLTaskJob/instance-95_43wmw v1
	[2024-02-15T17:09:49-0800] [MainThread] [I] [toil.wdl.wdltoil] Running task extractReads (['extractReads']) called as runExtractReads.extractReads
	[2024-02-15T17:09:49-0800] [MainThread] [I] [toil.wdl.wdltoil] Defaulting excludeString to ""
	[2024-02-15T17:09:49-0800] [MainThread] [I] [toil.wdl.wdltoil] Defaulting fastqOptions to ""
	[2024-02-15T17:09:49-0800] [MainThread] [I] [toil.wdl.wdltoil] Defaulting memSizeGB to 16
	[2024-02-15T17:09:49-0800] [MainThread] [I] [toil.wdl.wdltoil] Defaulting diskSizeGB to 128
	[2024-02-15T17:09:49-0800] [MainThread] [I] [MiniWDLContainers] no configuration file found
	[2024-02-15T17:09:49-0800] [MainThread] [N] [MiniWDLContainers] Singularity runtime initialized (BETA) :: singularity_version: "singularity-ce version 3.10.3"
	[2024-02-15T17:09:49-0800] [MainThread] [I] [MiniWDLContainers] detected host resources :: cpu: 256, mem_bytes: 2151640911872
	[2024-02-15T17:09:56-0800] [MainThread] [I] [MiniWDLContainers] Singularity SIF found in image cache directory :: sif: "/private/groups/patenlab/masri/apps/forked/hpp_production_workflows/QC/wdl/tasks/extract_reads_test/extract_reads_output_jsons/outputs/cache/.cache/miniwdl/docker___mobinasri_bio_base_dev-v0.1.sif"
	[2024-02-15T17:09:56-0800] [MainThread] [I] [toil.wdl.wdltoil] Executing command in <WDL.runtime.backend.singularity.SingularityContainer object at 0x7f8af40aafe0>: 
	        # Set the exit code of a pipeline to that of the rightmost command
	        # to exit with a non-zero status, or zero if all commands of the pipeline exit
	        set -o pipefail
	        # cause a bash script to exit immediately when a command fails
	        set -e
	        # cause the bash shell to treat unset variables as an error and exit immediately
	        set -u
	        # echo each line of the script to stdout so we can see what is happening
	        # to turn off echo do 'set +o xtrace'
	        set -o xtrace
	
	        FILENAME=$(basename -- "/mnt/miniwdl_task_container/work/_miniwdl_inputs/0/m64076_201013_225902.ccs.bam")
	        PREFIX="${FILENAME%.*}"
	        SUFFIX="${FILENAME##*.}"
	
	        mkdir output
	        SORT_BY_NAME=no
	
	        if [[ "$SUFFIX" == "bam" ]] ; then
	            if [[ ${SORT_BY_NAME} == "yes" ]]; then
	                samtools sort -@8 -n /mnt/miniwdl_task_container/work/_miniwdl_inputs/0/m64076_201013_225902.ccs.bam | samtools fastq  -@8 - > output/${PREFIX}.fq
	            else
	                samtools fastq  -@8 /mnt/miniwdl_task_container/work/_miniwdl_inputs/0/m64076_201013_225902.ccs.bam > output/${PREFIX}.fq      
	            fi
	        elif [[ "$SUFFIX" == "cram" ]] ; then
	            if [[ ! -f "/mnt/miniwdl_task_container/work/_miniwdl_inputs/0/GCA_000001405.15_GRCh38_no_alt_analysis_set.fna" ]] ; then
	                echo "Could not extract $FILENAME, reference file not supplied"
	                exit 1
	            fi
	            ln -s /mnt/miniwdl_task_container/work/_miniwdl_inputs/0/GCA_000001405.15_GRCh38_no_alt_analysis_set.fna
	            if [[ ${SORT_BY_NAME} == "yes" ]]; then
	                samtools sort -@8 -n --reference `basename /mnt/miniwdl_task_container/work/_miniwdl_inputs/0/GCA_000001405.15_GRCh38_no_alt_analysis_set.fna` -O bam /mnt/miniwdl_task_container/work/_miniwdl_inputs/0/m64076_201013_225902.ccs.bam | samtools fastq  -@8 - > output/${PREFIX}.fq
	            elif
	                samtools fastq  -@8 --reference `basename /mnt/miniwdl_task_container/work/_miniwdl_inputs/0/GCA_000001405.15_GRCh38_no_alt_analysis_set.fna` /mnt/miniwdl_task_container/work/_miniwdl_inputs/0/m64076_201013_225902.ccs.bam > output/${PREFIX}.fq
	            fi
	        elif [[ "$SUFFIX" == "gz" ]] ; then
	            gunzip -k -c /mnt/miniwdl_task_container/work/_miniwdl_inputs/0/m64076_201013_225902.ccs.bam > output/${PREFIX}
	        elif [[ "$SUFFIX" == "fastq" ]] || [[ "$SUFFIX" == "fq" ]] ; then
	            cp /mnt/miniwdl_task_container/work/_miniwdl_inputs/0/m64076_201013_225902.ccs.bam output/${PREFIX}.fq
	        elif [[ "$SUFFIX" != "fastq" ]] && [[ "$SUFFIX" != "fq" ]] && [[ "$SUFFIX" != "fasta" ]] && [[ "$SUFFIX" != "fa" ]] ; then
	            echo "Unsupported file type: ${SUFFIX}"
	            exit 1
	        fi
	
	
	        mkdir output_final
	        OUTPUT_NAME=$(ls output)
	
	        if [ "" != "" ]; then
	            cat output/${OUTPUT_NAME} | grep -v "" > output_final/${OUTPUT_NAME}
	        else
	            ln output/${OUTPUT_NAME} output_final/${OUTPUT_NAME}
	        fi
	        
	
	        OUTPUTSIZE=`du -s -BG output_final/ | sed 's/G.*//'`
	        if [[ "0" == $OUTPUTSIZE ]] ; then
	            OUTPUTSIZE=`du -s -BG /mnt/miniwdl_task_container/work/_miniwdl_inputs/0/m64076_201013_225902.ccs.bam | sed 's/G.*//'`
	        fi
	        echo $OUTPUTSIZE >outputsize
	    
	[2024-02-15T17:09:56-0800] [MainThread] [I] [MiniWDLContainers] provisioned :: seconds_waited: 0, cpu: 8, mem_bytes: 16000000000
	[2024-02-15T17:09:56-0800] [MainThread] [I] [MiniWDLContainers] Singularity SIF found in image cache directory :: sif: "/private/groups/patenlab/masri/apps/forked/hpp_production_workflows/QC/wdl/tasks/extract_reads_test/extract_reads_output_jsons/outputs/cache/.cache/miniwdl/docker___mobinasri_bio_base_dev-v0.1.sif"
	[2024-02-15T17:09:56-0800] [MainThread] [I] [MiniWDLContainers] singularity invocation :: args: "singularity exec --pwd /mnt/miniwdl_task_container/work --containall --no-mount hostfs --fakeroot /private/groups/patenlab/masri/apps/forked/hpp_production_workflows/QC/wdl/tasks/extract_reads_test/extract_reads_output_jsons/outputs/cache/.cache/miniwdl/docker___mobinasri_bio_base_dev-v0.1.sif", binds: 8, tmpdir: "/data/tmp/bc6de80c74205c86b17598b671c3ea3a/68ce/e872/_singularity_tmpdir_d34ik7ij"
	[2024-02-15T17:09:56-0800] [MainThread] [W] [toil.wdl.wdltoil] No subuids are assigned to masri; cannot fake root.
	[2024-02-15T17:09:56-0800] [MainThread] [N] [MiniWDLContainers] singularity run :: pid: 3186580, log: "/data/tmp/bc6de80c74205c86b17598b671c3ea3a/68ce/e872/singularity.log.txt"
	[2024-02-15T17:09:56-0800] [MainThread] [I] [toil.wdl.wdltoil] Standard error at /data/tmp/bc6de80c74205c86b17598b671c3ea3a/68ce/e872/stderr.txt: ++ basename -- /mnt/miniwdl_task_container/work/_miniwdl_inputs/0/m64076_201013_225902.ccs.bam
	+ FILENAME=m64076_201013_225902.ccs.bam
	+ PREFIX=m64076_201013_225902.ccs
	+ SUFFIX=bam
	+ mkdir output
	+ SORT_BY_NAME=no
	../command: line 36: syntax error near unexpected token `fi'
	
	[2024-02-15T17:09:56-0800] [MainThread] [I] [toil.wdl.wdltoil] Standard output at /data/tmp/bc6de80c74205c86b17598b671c3ea3a/68ce/e872/stdout.txt: 
	[2024-02-15T17:09:56-0800] [MainThread] [W] [toil.fileStores.abstractFileStore] Failed job accessed files:
	[2024-02-15T17:09:56-0800] [MainThread] [W] [toil.fileStores.abstractFileStore] Downloaded file 'files/no-job/file-a382b4b6727449b7b872beaf4d6d8bf7/GCA_000001405.15_GRCh38_no_alt_analysis_set.fna' to path '/data/tmp/bc6de80c74205c86b17598b671c3ea3a/68ce/e872/tmpvmo3wdkb/GCA_000001405.15_GRCh38_no_alt_analysis_set.fna'
	[2024-02-15T17:09:56-0800] [MainThread] [W] [toil.fileStores.abstractFileStore] Downloaded file 'files/no-job/file-f51b53882cc747e699e0f3c310a9731e/m64076_201013_225902.ccs.bam' to path '/data/tmp/bc6de80c74205c86b17598b671c3ea3a/68ce/e872/tmp_aeotbf6/m64076_201013_225902.ccs.bam'
	Traceback (most recent call last):
	  File "/private/home/masri/.local/lib/python3.10/site-packages/toil/worker.py", line 403, in workerScript
	    job._runner(jobGraph=None, jobStore=jobStore, fileStore=fileStore, defer=defer)
	  File "/private/home/masri/.local/lib/python3.10/site-packages/toil/job.py", line 2774, in _runner
	    returnValues = self._run(jobGraph=None, fileStore=fileStore)
	  File "/private/home/masri/.local/lib/python3.10/site-packages/toil/job.py", line 2691, in _run
	    return self.run(fileStore)
	  File "/private/home/masri/.local/lib/python3.10/site-packages/toil/wdl/wdltoil.py", line 1246, in run
	    task_container.run(miniwdl_logger, command_string)
	  File "/private/home/masri/.local/lib/python3.10/site-packages/WDL/runtime/task_container.py", line 326, in run
	    raise CommandFailed(
	WDL.runtime.error.CommandFailed: task command failed with exit status 2
	[2024-02-15T17:09:56-0800] [MainThread] [E] [toil.worker] Exiting the worker because of a failed job on host phoenix-14.prism
<=========
slurmstepd-phoenix-14: error: *** JOB 2091665 ON phoenix-14 CANCELLED AT 2024-02-15T17:10:09 ***
